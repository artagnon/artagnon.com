Linux on a 2013 Macbook Pro

I faced some inital hiccups in the Arch Linux installation, because
the installation image doesn't contain the wireless driver. Linux
lists the card as:

    03:00.0 Ethernet controller: Broadcom Corporation Device 16a3 (rev 10)

The proprietary driver, broadcom-wl-dkms [1], requires atleast kernel
headers and base-devel, which aren't present in the installation
image. After trying to copy all the necessary packages onto a
different USB stick a few times, I gave up; I found out that the free
driver, b43 (included in the installation image kernel), works
somewhat provided it's given the proprietary firmware files [2]. By
somewhat, I mean that the connection is unstable and keeps dropping
randomly. Using the partition scheme described here [3] (I decided to
keep OS X on a small 30G paritition for firmware updates), and after a
painful wait for pacstrap, I finally had an Arch install.

Getting it to boot was relatively straightforward. As described in
[4], I installed rEFInd from OS X using `install.sh --nodrivers` with
"scan_all_linux_kernels" and "also_scan_dirs" enabled. Reboot and
rEFInd automagically detects the Linux kernel present on the /boot of
the Linux installation. To get it to boot, you have to communicate the
root partition to the kernel by creating a `refind_linux.conf` on the
/boot of the Linux installation:

    "Default" "root=UUID=b7fcbb0e-8f10-43c2 rw rootfstype=ext4 add_efi_memmap"

Once it booted up, I installed broadcom-wl-dkms; it automatically
blacklists the b43 driver and steps in.

After bootup, the two main annoyances are small fonts on the retina
display and trackpad functionality. All GNOME applications respect an

    Xft.dpi 160

in ~/.Xdefaults. For Emacs and the terminal, set font sizes by
hand. Unfortunately, there's little you can do about Chrome other than
increasing the page zoom from settings; even then, the tabs still
display tiny text. This is an unresolved bug from 2006~2008 [5][6].

For the trackpad, stick to the synaptics driver because the mtrack
driver [7] is immature and rotting. I found that the ideal
/etc/X11/xorg.conf.d/50-synaptics.conf includes:

    Section "InputClass"
      Identifier "touchpad catchall"
      Driver "synaptics"
      MatchIsTouchpad "on"
      Option "TapButton1" "1"
      Option "TapButton2" "2"
      Option "TapButton3" "3"
      Option "ClickFinger1" "1"
      Option "ClickFinger2" "2"
      Option "ClickFinger3" "3"
      Option "PalmDetect" "1"
      Option "HorizTwoFingerScroll" "1"
      Option "VertScrollDelta" "-100"
      Option "HorizScrollDelta" "-100"
      MatchDevicePath "/dev/input/event*"
    EndSection

I decided that the minor things like the keyboard backlight, light
sensor, multimedia keys, and multi-touch gestures were too much
trouble to set up.

On a final note, the battery life is a definite a pain point. Linux
lasts 4 hours consuming 21W, while OS X lasts 8 hours consuming 9W;
essentially, Linux halves the battery life, but I haven't been able to
pinpoint the root cause. Perhaps a custom kernel stripped of
unnecessary modules will perform better.

[1]: https://aur.archlinux.org/packages/broadcom-wl-dkms
[2]: https://aur.archlinux.org/packages/b43-firmware
[3]: https://wiki.archlinux.org/index.php/MacBook#EFI_2
[4]: https://wiki.archlinux.org/index.php/MacBookPro11,x#Direct_EFI_booting_.28rEFInd.29
[5]: https://code.google.com/p/chromium/issues/detail?id=679
[6]: https://bugs.webkit.org/show_bug.cgi?id=11644
[7]: https://github.com/BlueDragonX/xf86-input-mtrack
