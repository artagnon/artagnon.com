<!DOCTYPE html>
<html>
  <head>
    <title>artagnon.com: gpt-grub</title>
    <meta charset="UTF-8" />
    <meta name="description" content="Ramkumar Ramachandra's site" />
    <meta name="author" content="Ramkumar Ramachandra" />
    <meta name="keywords" content="programming, linux, philosophy, git" />
    <link rel="stylesheet" href="/design/screen.css" media="screen" />
    <link rel="stylesheet" href="/design/mobile.css" media="only screen and (max-device-width:480px)" />
    <link rel="stylesheet" href="/design/claytext.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono" />
    <link rel="shortcut icon" href="/design/favicon.ico" />
  </head>
  <body>
    <div id="wrapper">
      <div id="main">
        <h1>A note on GPT and GRUB2</h1>
        <p>GUID Partition Table (GPT) is a new style of partitioning meant to
          replace the older MBR-style (Master Boot Record) partitions.  Earlier,
          we would start the first partition a few sectors after the beginning
          of the physical disk, and stuff the bootloader into the unpartitioned
          space between the physical disk and the first paritition (ie. the
          MBR).  This is a really bad hack.  For instance, if you use fdisk to
          partition your disk and stick to the default sector start (which is
          sector 63, by the way), `grub-install` from GRUB2 will complain that
          there isn&#39;t enough space to fit core.img.</p>
        <p>GPT fixes this problem by having a special partition type called BIOS
          Boot Parition (ef02 in gdisk), which is meant exclusively for the
          bootloader.  So, a BIOS Boot partition is typically a small (~1 MiB)
          partition at the start of the disk (not necessarily; it can be
          anywhere within the first 2 TiB), without a filesystem.  GRUB2 is
          GPT-aware, which means that `grub-install /dev/sdx` will look for a
          BIOS Boot partition on /dev/sdx to write core.img to.  As an example,
          my boot disk looks like this:</p><pre><span class="codeblock">GPT fdisk (gdisk) version 0.8.6

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.
Disk /dev/sda: 488395055 sectors, 232.9 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): 9752BAB3-9CAB-42F6-9A0B-A5DE3109E256
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 488395021
Partitions will be aligned on 2048-sector boundaries
Total free space is 2048 sectors (1024.0 KiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            4061   1007.0 KiB  EF02  BIOS boot partition
   2            4096       488395021   232.9 GiB   8E00  Linux LVM</span></pre>
        <p>FOOTNOTE: gfdisk is a drop-in replacement for fdisk with the same
          command syntax, with added GPT support.  The best part is you can
          convert an MBR disk to GPT by just issuing a `w` (write) after opening
          it with `gfdisk /dev/sdx` without suffering data loss.
          </p>
      </div>
      <div id="sidebar">
        <ul>
          <li>
            <a href="/index">index</a>
          </li>
          <li>
            <a href="/log">log</a>
          </li>
          <li>
            <a href="/colophon">colophon</a>
          </li>
        </ul>
      </div>
    </div>
  </body>
</html>